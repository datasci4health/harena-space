/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/rete-connection-plugin@0.9.0/build/connection-plugin.common.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";function ___$insertStyle(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}Object.defineProperty(exports,"__esModule",{value:!0});var rete=require("rete");function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArrayLimit(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var c,a=e[Symbol.iterator]();!(i=(c=a.next()).done)&&(n.push(c.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return n}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function toTrainCase(e){return e.toLowerCase().replace(/ /g,"-")}function getMapItemRecursively(e,t){return e.get(t)||(t.parentElement?getMapItemRecursively(e,t.parentElement):null)}function defaultPath(e,t){var n=_slicedToArray(e,4),i=n[0],o=n[1],r=n[2],c=n[3],a=i+Math.abs(r-i)*t,s=r-Math.abs(r-i)*t;return"M ".concat(i," ").concat(o," C ").concat(a," ").concat(o," ").concat(s," ").concat(c," ").concat(r," ").concat(c)}function renderPathData(e,t,n){var i={points:t,connection:n,d:""};return e.trigger("connectionpath",i),i.d||defaultPath(t,.4)}function updateConnection(e){var t=e.el,n=e.d,i=t.querySelector(".connection path");if(!i)throw new Error("Path of connection was broken");i.setAttribute("d",n)}function renderConnection(e){var t,n=e.el,i=e.d,o=e.connection,r=o?["input-"+toTrainCase(o.input.name),"output-"+toTrainCase(o.output.name),"socket-input-"+toTrainCase(o.input.socket.name),"socket-output-"+toTrainCase(o.output.socket.name)]:[],c=document.createElementNS("http://www.w3.org/2000/svg","svg"),a=document.createElementNS("http://www.w3.org/2000/svg","path");(t=c.classList).add.apply(t,["connection"].concat(r)),a.classList.add("main-path"),a.setAttribute("d",i),c.appendChild(a),n.appendChild(c),updateConnection({el:n,d:i})}var PickerView=function(){function e(t,n){_classCallCheck(this,e),this.emitter=t,this.editorView=n,_defineProperty(this,"el",void 0),this.el=document.createElement("div"),this.el.style.position="absolute",this.editorView.area.appendChild(this.el)}return _createClass(e,[{key:"updatePseudoConnection",value:function(e){null!==e?this.renderConnection(e):this.el.parentElement&&(this.el.innerHTML="")}},{key:"getPoints",value:function(e){var t=this.editorView.area.mouse;if(!e.node)throw new Error("Node in output/input not found");var n=this.editorView.nodes.get(e.node);if(!n)throw new Error("Node view not found");var i=_slicedToArray(n.getSocketPosition(e),2),o=i[0],r=i[1];return e instanceof rete.Output?[o,r,t.x,t.y]:[t.x,t.y,o,r]}},{key:"updateConnection",value:function(e){var t=renderPathData(this.emitter,this.getPoints(e));updateConnection({el:this.el,d:t})}},{key:"renderConnection",value:function(e){var t=renderPathData(this.emitter,this.getPoints(e));renderConnection({el:this.el,d:t})}}]),e}(),Picker=function(){function e(t){var n=this;_classCallCheck(this,e),_defineProperty(this,"editor",void 0),_defineProperty(this,"_io",null),_defineProperty(this,"view",void 0),this.editor=t,this.view=new PickerView(t,t.view),t.on("mousemove",function(){return n.io&&n.view.updateConnection(n.io)})}return _createClass(e,[{key:"reset",value:function(){this.io=null}},{key:"pickOutput",value:function(e){if(this.editor.trigger("connectionpick",e)){if(this.io instanceof rete.Input)return!e.multipleConnections&&e.hasConnection()&&this.editor.removeConnection(e.connections[0]),this.editor.connect(e,this.io),void this.reset();this.io&&this.reset(),this.io=e}}},{key:"pickInput",value:function(e){var t=this;if(this.editor.trigger("connectionpick",e)){if(null===this.io)return e.hasConnection()?(this.io=e.connections[0].output,this.editor.removeConnection(e.connections[0])):this.io=e,!0;if(!e.multipleConnections&&e.hasConnection()&&this.editor.removeConnection(e.connections[0]),!this.io.multipleConnections&&this.io.hasConnection()&&this.editor.removeConnection(this.io.connections[0]),this.io instanceof rete.Output&&this.io.connectedTo(e)){var n=e.connections.find(function(e){return e.output===t.io});n&&this.editor.removeConnection(n)}this.io instanceof rete.Output&&(this.editor.connect(this.io,e),this.reset())}}},{key:"pickConnection",value:function(e){var t=e.output;this.editor.removeConnection(e),this.io=t}},{key:"io",get:function(){return this._io},set:function(e){this._io=e,this.view.updatePseudoConnection(e)}}]),e}(),Flow=function(){function e(t){_classCallCheck(this,e),_defineProperty(this,"picker",void 0),_defineProperty(this,"target",void 0),this.picker=t,this.target=null}return _createClass(e,[{key:"act",value:function(e){var t=e.input,n=e.output;this.unlock(t||n)||(t?this.picker.pickInput(t):n?this.picker.pickOutput(n):this.picker.reset())}},{key:"start",value:function(e,t){this.act(e),this.target=t}},{key:"complete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.act(e)}},{key:"hasTarget",value:function(){return Boolean(this.target)}},{key:"unlock",value:function(e){var t=this.target;return this.target=null,t&&t===e}}]),e}();function install(e){e.bind("connectionpath"),e.bind("connectiondrop"),e.bind("connectionpick"),e.bind("resetconnection");var t=new Picker(e),n=new Flow(t),i=new WeakMap;function o(t){var o=i.get(this);if(o){var r=o.input,c=o.output;e.view.container.dispatchEvent(new PointerEvent("pointermove",t)),t.preventDefault(),t.stopPropagation(),n.start({input:r,output:c},r||c)}}function r(o){var r=document.elementFromPoint(o.clientX,o.clientY);t.io&&e.trigger("connectiondrop",t.io),r&&n.complete(getMapItemRecursively(i,r)||{})}e.on("resetconnection",function(){return n.complete()}),e.on("rendersocket",function(e){var t=e.el,n=e.input,r=e.output;i.set(t,{input:n,output:r}),t.removeEventListener("pointerdown",o),t.addEventListener("pointerdown",o)}),window.addEventListener("pointerup",r),e.on("renderconnection",function(t){var n=t.el,i=t.connection,o=t.points;renderConnection({el:n,d:renderPathData(e,o,i),connection:i})}),e.on("updateconnection",function(t){var n=t.el,i=t.connection,o=t.points;updateConnection({el:n,d:renderPathData(e,o,i)})}),e.on("destroy",function(){window.removeEventListener("pointerup",r)})}___$insertStyle(".connection {\n  overflow: visible !important;\n  position: absolute;\n  z-index: -1;\n  pointer-events: none; }\n  .connection > * {\n    pointer-events: all; }\n  .connection .main-path {\n    fill: none;\n    stroke-width: 5px;\n    stroke: steelblue; }\n");var index={name:"connection",install:install};exports.default=index,exports.defaultPath=defaultPath;
//# sourceMappingURL=/sm/5c140d7f3b7980e1639b710f78ec390fcc48dca69d21c1560eea2bc16551e5fd.map